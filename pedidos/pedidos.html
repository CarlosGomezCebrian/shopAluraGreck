<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos</title>
    <style>
        :root {
            --clr-main: #c7003f;
            --clr-main-light: #fc5288;
            --clr-white: #ececec;
            --clr-gray: #e2e2e2;
        }

        body {
            background-color: var(--clr-gray);
            color: var(--clr-main);
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: var(--clr-main);
        }

        table {
            border-collapse: collapse;
            width: 80%;
            margin-top: 20px;
            border-radius: 1rem;
            overflow: hidden;
        }

        th,
        td {
            border: 1px solid var(--clr-main);
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: var(--clr-main);
            color: var(--clr-gray);
        }

        tr:nth-child(even) {
            background-color: var(--clr-gray);
            color: var(--clr-main);
        }

        tr:nth-child(odd) {
            background-color: var(--clr-white);
            /* Celdas azul claro */
            color: var(--clr-main);
        }

        #inputId,
        button {
            margin-top: 10px;
            color: #c7003f;
            background-color: #e2e2e2;
            border: 1px solid #c7003f;
            border-radius: 1rem;
            padding: 8px;
            max-width: 60px;

        }
    </style>
</head>

<body>

    <input type="number" id="inputId">

    <button onclick="cambiarEstadoCerrado()">Carrar</button>

    <h1>Pedidos</h1>

    <table border="1">
        <thead>
            <tr>
                <th translate="no">ID</th>
                <th>Pedido</th>
                <th>Código Usuario</th>
                <th># de Producto</th>
                <th>Código</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Subtotal</th>
                <th>Pago Total</th>
            </tr>
        </thead>
        <tbody id="tablaPedidosBody"></tbody>
    </table>

    <script>
        // Función para obtener datos de la base de datos

        async function obtenerDatosDesdeServidor() {
            try {
                let db = 'https://cgshop.cgwis.com/pedidos/coneccionPedidos.php';
                let dbJ = './pedidos.json';
                const respuesta = await fetch(db);

                if (!respuesta.ok) {
                    throw new Error(`Error en la respuesta del servidor: ${respuesta.statusText}`);
                }

                const datos = await respuesta.json();
                return datos; // Accede al array de objetos dentro del objeto JSON devuelto
            } catch (error) {
                console.error('Error al obtener datos desde el servidor:', error);
                return [];
            }
        }



        /*
        async function obtenerDatosDesdeServidor() {
            try {
                let db = 'https://cgshop.cgwis.com/pedidos/coneccionPedidos.php';
                let dbJ = './pedidos.json';
                const respuesta = await fetch(db);

                if (!respuesta.ok) {
                    throw new Error(`Error en la respuesta del servidor: ${respuesta.statusText}`);
                }

                const datos = await respuesta.json();
                return datos;
            } catch (error) {
                console.error('Error al obtener datos desde el servidor:', error);
                return [];
            }
        }*/


        // Función para llenar la tabla con los datos obtenidos del servidor
        async function llenarTabla() {
            var tablaBody = document.getElementById('tablaPedidosBody');
            tablaBody.innerHTML = '';

            // Obtener datos desde el servidor
            var datosPedidos = await obtenerDatosDesdeServidor();

            datosPedidos.forEach(function (pedido) {
                var fila = document.createElement('tr');

                for (var propiedad in pedido) {
                    var celda = document.createElement('td');
                    celda.textContent = pedido[propiedad];
                    fila.appendChild(celda);
                }

                tablaBody.appendChild(fila);
            });
        }

        async function cambiarEstadoCerrado() {
            var inputId = document.getElementById('inputId');
            var id = inputId.value;

            // Validar que el ID sea un número
            if (isNaN(id)) {
                alert('Ingrese un número válido para el ID.');
                return;
            }

            // Realizar la solicitud al servidor para cambiar el estado cerrado
            try {
                await fetch(`https://cgshop.cgwis.com/pedidos/cambiarEstadoCerrado.php?id=${id}`, {
                    method: 'POST', // Puedes cambiar a 'GET' si lo prefieres
                });

                // Actualizar la tabla después de cambiar el estado
                llenarTabla();
            } catch (error) {
                console.error('Error al cambiar el estado cerrado:', error);
            }
        }

        // Llama a la función para llenar la tabla al cargar la página
        llenarTabla();

    </script>

</body>

</html>